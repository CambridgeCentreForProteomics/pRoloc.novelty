<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Annotating spatial proteomics data • pRoloc</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">pRoloc</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lgatto/pRoloc">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Annotating spatial proteomics data</h1>
                        <h4 class="author">Lisa M. Breckels</h4>
            <address class="author_afil">
      Computational Proteomics Unit, Cambridge, UK<br><h4 class="author">Laurent Gatto</h4>
            <address class="author_afil">
      Computational Proteomics Unit, Cambridge, UK<br>
</address>
</address>
</div>

    
    
<div class="contents">
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><div id="foreword" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#foreword" class="anchor"></a>Foreword</h1>
<p>This document walks users through a typical pipeline for adding annotation information to spatial proteomics data. For a general practical introduction to pRoloc and spatial proteomics data analysis, readers are referred to the tutorial, available using <code>vignette("pRoloc-tutorial", package = "pRoloc")</code>.</p>
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Exploring protein annotations and defining sub-cellular localisation markers (i.e. known residents of a specific sub-cellular niche in a species, under a condition of interest) play important roles in the analysis of spatial proteomics data. The latter is essential for downstream supervised machine learning (ML) classification for protein localisation prediction (see <code>vignette("pRoloc-tutorial", package = "pRoloc")</code> and <code>vignette("pRoloc-ml", package = "pRoloc")</code> for information on available ML methods) and the former is interesting for initial biological interpretation through matching annotations to the data structure.</p>
<p>Robust protein-localisation prediction is reliant on markers that reflect the true sub-cellular diversity of the multivariate data. The validity of markers is generally assured by expert curation. This can be time consuming and difficult owing to the limited number of marker proteins that exist in databases and elsewhere. The Gene Ontology (GO) database, and in particular the cellular compartment (CC) namespace provide a good starting point for protein annotation and marker definition. Nevertheless, automatic extraction from databases, and in particular GO CC, is only a first step in sub-cellular localisation analysis and requires additional curation to counter unreliable annotation based on data that is inaccurate or out of context for the biological question under investigation.</p>
<p>To facilitate the above, we have developed an annotation retrieval and management system that provides a flexible framework for the exploration of the sub-cellular proteomics data. We have developed a method to correlate annotation information with the multivariate data space to identify densely annotated regions and assess cluster tightness. Given a set of proteins that share some property e.g. a specified GO term, a k-means clustering is used to fit the data (testing <code>k = 1:5</code>) and then for each number of <code>k</code> components tested, all pairwise Euclidean distances are calculated per component, and then normalised. The minimum mean normalised distance is then extracted and used as a measure of cluster tightness. This is repeated for all protein/annotation sets. These sets are then ranked according to minimum mean normalised distance and then can be displayed and explored using the <em><a href="http://bioconductor.org/packages/pRolocGUI">pRolocGUI</a></em> package.</p>
<p>In this vignette we present a step-by-step guide showing users how to (1) how to add protein annotations, here we use the GO database as an example, and (2) rank and order information (e.g. GO terms) according to their correlation with the data structure, for the extraction of optimal data specific annotated clusters.</p>
</div>
<div id="loading-the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#loading-the-data" class="anchor"></a>Loading the data</h1>
<p>We will demonstrate our pipeline for adding and ranking annotation information using a LOPIT experiment on Pluripotent Mouse Embryonic stems (<a href="http://www.nature.com/ncomms/2016/160112/ncomms9992/full/ncomms9992.html">Christoforou et al 2016</a>), available and documented in the <em><a href="http://bioconductor.org/packages/pRolocdata">pRolocdata</a></em> data package as <code>hyperlopit2015</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"pRoloc"</span>)
<span class="kw">library</span>(<span class="st">"pRolocdata"</span>)

## Subset data for markers for example
<span class="kw">data</span>(<span class="st">"hyperLOPIT2015"</span>)
hyperLOPIT2015 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/markerMSnSet.html">markerMSnSet</a></span>(hyperLOPIT2015)</code></pre></div>
</div>
<div id="adding-sub-cellular-localisation-information" class="section level1">
<h1 class="hasAnchor">
<a href="#adding-sub-cellular-localisation-information" class="anchor"></a>Adding sub-cellular localisation information</h1>
<p>All GO terms associated to proteins that appear in the dataset are retrieved and used to create a binary matrix where a 1 (0) at position <span class="math inline">\((i,j)\)</span> indicates that term <span class="math inline">\(j\)</span> has (not) been used to annotate feature <span class="math inline">\(i\)</span>. This matrix is appended and stored in the feature data slot of the <code>MSnSet</code> dataset using the <code>addGoAnnotations</code> function. We first however need to prepare annotation parameters that will enable us to query the Biomart repository using the  package, from where we are able to retrieve GO terms. The specific Biomart repository and query will depend on the species under study and the type of features. This can be set using the <code>setAnnotationParams</code> function.</p>
<p>In the code chunk below we set the annotation parameters for the <code>hyperLOPIT2015</code> dataset. As this species used was mouse and the <code>featureNames</code> of the <code>hyperLOPIT2015</code> dataset are Uniprot accession numbers the input to the function is defined as <code>inputs = c("Mus musculus", "UniProtKB/Swiss-Prot ID")</code>. See <code><a href="../reference/AnnotationParams-class.html">?setAnnotationParams</a></code> for details.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">params &lt;-<span class="st"> </span><span class="kw"><a href="../reference/AnnotationParams-class.html">setAnnotationParams</a></span>(<span class="dt">inputs =</span> <span class="kw">c</span>(<span class="st">"Mus musculus"</span>, 
                                         <span class="st">"UniProtKB/Swiss-Prot ID"</span>))</code></pre></div>
<pre><code>## Using species Mus musculus genes (GRCm38.p4)</code></pre>
<pre><code>## Using feature type UniProtKB/Swiss-Prot ID(s) [e.g. A0A0A6YXX9]</code></pre>
<pre><code>## Connecting to Biomart...</code></pre>
<p>Now the parameters for the search have been defined we can use the <code>addGoAnnotations</code> function to add a GO information matrix to the <code>featureData</code> slot of the dataset. The <code>addGoAnnotations</code> function takes a <code>MSnSet</code> instance as input (from which the <code>featureNames</code> will be extracted) and it downloads the CC terms (the default, biological process and the molecular function namespaces are also supported) found for each protein in the dataset. The output <code>MSnSet</code> has the CC term binary matrix appended to the <code>fData</code>, by default this is called <code>GOAnnotations</code> (and changed using the <code>fcol</code> argument).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/addGoAnnotations.html">addGoAnnotations</a></span>(hyperLOPIT2015, params, 
                       <span class="dt">namespace =</span> <span class="st">"cellular_component"</span>)
<span class="kw">fvarLabels</span>(cc)</code></pre></div>
<pre><code>##  [1] "entry.name"                "protein.description"      
##  [3] "peptides.rep1"             "peptides.rep2"            
##  [5] "psms.rep1"                 "psms.rep2"                
##  [7] "phenodisco.input"          "phenodisco.output"        
##  [9] "curated.phenodisco.output" "markers"                  
## [11] "svm.classification"        "svm.score"                
## [13] "svm.top.quartile"          "final.assignment"         
## [15] "first.evidence"            "curated.organelles"       
## [17] "cytoskeletal.components"   "trafficking.proteins"     
## [19] "protein.complexes"         "signalling.cascades"      
## [21] "oct4.interactome"          "nanog.interactome"        
## [23] "sox2.interactome"          "cell.surface.proteins"    
## [25] "markers2015"               "GOAnnotations"</code></pre>
<p>The <code>addGoAnnotations</code> function by defualt does not do any filtering of the terms evidence codes unless specified in the <code>evidence</code> argument, see <code><a href="../reference/addGoAnnotations.html">?addGoAnnotations</a></code> for more details.</p>
<p>With many well-annotated species and datasets containing typically thousands of proteins, we often find many CC terms, of which many may not be particularly meaningful. These such terms can be filtered out using the <code>filerMinMarkers</code> and <code>filterMaxMarkers</code> functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Next we filter the GO term matrix removing any terms that have
## have less than `n` proteins or greater than `p` % of total proteins 
## in the dataset (this removes terms that only have very few proteins 
## and very general terms)
cc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/filterMinMarkers.html">filterMinMarkers</a></span>(cc)
cc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/filterMaxMarkers.html">filterMaxMarkers</a></span>(cc)</code></pre></div>
</div>
<div id="correlating-and-ordering-annotation-information" class="section level1">
<h1 class="hasAnchor">
<a href="#correlating-and-ordering-annotation-information" class="anchor"></a>Correlating and ordering annotation information</h1>
<p>Now we have extracted and filtered annotation information for our dataset we re-order the <code>GOAnnotations</code> matrix of terms according to their correlation with the dataset structure. To do this we use the <code>orderGoAnnotations</code> function.</p>
<p>For each piece of annotation information, e.g. for each GO CC term in the matrix, the function:</p>
<ol style="list-style-type: decimal">
<li>Extracts all instances (proteins) with the specified term</li>
<li>Fits <code>k</code> component clusters to this subset using the <code>kmeans</code> algorithm (the default to test is <code>k = 1:5</code>).</li>
<li>Calculates all pairwise Euclidean distances per component cluster</li>
<li>Normalises each component by the cubed root of the number of instances per component (this was set heuristically through individual tests and can be set using the argument <code>p</code>)</li>
<li>Orders the annotation information in <code>GOAnnotations</code> according to the minimum normalised Euclidean distance.</li>
</ol>
<p>We find that high density clusters have the low mean normalised Euclidean distances. In the below chunk we test try fitting <code>k = 1:3</code> component clusters per term and normalise by <code>p = 1/3</code>. The ordered terms can be displayed using the <code>pRolocVis</code> function in the <code>pRolocGUI</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Extract markers can use n to specify to select top n terms
res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/orderGoAnnotations.html">orderGoAnnotations</a></span>(cc, <span class="dt">k =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">p =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## Calculating GO cluster densities</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"pRolocGUI"</span>)
<span class="kw">pRolocVis</span>(res, <span class="dt">fcol =</span> <span class="st">"GOAnnotations"</span>)</code></pre></div>
<div id="examining-distances" class="section level2">
<h2 class="hasAnchor">
<a href="#examining-distances" class="anchor"></a>Examining distances</h2>
<p>Instead of using the <code>orderGoAnnotations</code> function which is a wrapper for steps 1 - 5 above, it is possible to calculate the Euclidean distances manually using the <code>clustDist</code> function. The input is a <code>MSnSet</code> dataset with the matrix of markers e.g. <code>GOAnnotations</code> appended to the <code>fData</code> slot. The output is a <code>"ClustDistList"</code>. The <code>"ClustDist"</code> and <code>"ClustDistList"</code> class summarises the algorithm information such as the number of k’s tested for the kmeans, and mean and normalised pairwise Euclidean distances per numer of component clusters tested.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Now calculate distances
dd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clustDist.html">clustDist</a></span>(cc, <span class="dt">fcol =</span> <span class="st">"GOAnnotations"</span>, <span class="dt">k =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
dd[[<span class="dv">1</span>]]</code></pre></div>
<pre><code>## Object of class "ClustDist"
## fcol =  GOAnnotations 
##  term =  GO:0005886 
##  id =  plasma membrane 
##  nrow =  106 
## k's tested: 1 2 3 
##   Size:  106 
##   Size:  31, 75 
##   Size:  26, 67, 13 
## Clusters info:
##       ks.mean    mean ks.norm    norm
## k = 1       1  0.5069       1  0.1071
## k = 2       2  0.3675       2 *0.1033
## k = 3       3 *0.3348       3  0.1196</code></pre>
<p>We can use the <code>plotClustDist</code> and <code>plotComponents</code> to visualise these results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Plot normalised distances 
<span class="kw">plot</span>(dd, <span class="dt">p =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)</code></pre></div>
<p><img src="pRoloc-goannotations_files/figure-html/visualiseRes-1.png" width="1152"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Examine kmeans clustering
<span class="kw">plot</span>(dd[[<span class="dv">1</span>]], cc)</code></pre></div>
<p><img src="pRoloc-goannotations_files/figure-html/visualiseRes-2.png" width="1152"></p>
<p>The output of <code>plotClustDist</code> is a boxplot of the normalised distances per term and the output of <code>plotComponents</code> is a set of principal components analysis (PCA) plots, one for each <code>k</code> tested, highlighting the component clusters found according to the kmeans algorithm.</p>
<p>The <code>getNormDist</code> function can be used to extract a <code>vector</code> of normalised distances. Which can then be used to rank and order the terms in the <code>GOAnnotations</code> matrix, as per the code chunk below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Normalise by n^1/3
minDist &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getNormDist.html">getNormDist</a></span>(dd, <span class="dt">p =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)

## Get new order according to lowest distance
o &lt;-<span class="st"> </span><span class="kw">order</span>(minDist)

## Re-order `GOAnnotations` matrix in `fData`
<span class="kw">fData</span>(cc)<span class="op">$</span>GOAnnotations &lt;-<span class="st"> </span><span class="kw">fData</span>(cc)<span class="op">$</span>GOAnnotations[, o]</code></pre></div>
<p>Finally, we can use the <code>pRolocVis</code> function in <code>pRolocGUI</code> to visualise our clusters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pRolocVis</span>(cc, <span class="dt">fcol =</span> <span class="st">"GOAnnotations"</span>)</code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#foreword">Foreword</a></li>
      <li><a href="#introduction">Introduction</a></li>
      <li><a href="#loading-the-data">Loading the data</a></li>
      <li><a href="#adding-sub-cellular-localisation-information">Adding sub-cellular localisation information</a></li>
      <li>
<a href="#correlating-and-ordering-annotation-information">Correlating and ordering annotation information</a><ul class="nav nav-pills nav-stacked">
<li><a href="#examining-distances">Examining distances</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Laurent Gatto, Lisa Breckels.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
